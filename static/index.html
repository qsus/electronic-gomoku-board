<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electronic Gomoku Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin-bottom: 20px;
        }
        #board {
            display: inline-block;
            border-collapse: collapse;
            margin: 20px auto;
        }
        #board td {
            width: 30px;
            height: 30px;
            border: 1px solid #000;
            text-align: center;
            font-size: 12px;
        }
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Electronic Gomoku Board</h1>
    
    <div id="connection-status" class="status disconnected">Disconnected</div>
    
    <div id="board-container">
        <table id="board"></table>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const board = document.getElementById('board');
            const connectionStatus = document.getElementById('connection-status');
            let socket;
            let interval;
            
            // Initialize the board table with 15x15 cells
            function initBoard() {
                board.innerHTML = '';
                for (let i = 0; i < 15; i++) {
                    const row = document.createElement('tr');
                    for (let j = 0; j < 15; j++) {
                        const cell = document.createElement('td');
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        cell.textContent = '0';
                        row.appendChild(cell);
                    }
                    board.appendChild(row);
                }
            }
            
            // Update the board with received data
            function updateBoard(data) {
                if (!Array.isArray(data) || data.length !== 15) return;
                
                for (let i = 0; i < 15; i++) {
                    if (!Array.isArray(data[i]) || data[i].length !== 15) continue;
                    
                    for (let j = 0; j < 15; j++) {
                        const cell = board.querySelector(`td[data-row="${i}"][data-col="${j}"]`);
                        if (cell) {
                            cell.textContent = data[i][j];
                            
                            // Optional: Add visual indicator based on value
                            cell.style.backgroundColor = data[i][j] == 0 ? '#ffffff' : 
                                                        data[i][j] == 1 ? '#000000' : 
                                                        data[i][j] == 2 ? '#ffffff' : '#e0e0e0';
                            
                            cell.style.color = data[i][j] == 1 ? '#ffffff' : '#000000';
                        }
                    }
                }
            }
            
            // Connect to WebSocket
            function connect() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws`;
                
                socket = new WebSocket(wsUrl);
                
                socket.onopen = () => {
                    connectionStatus.textContent = 'Connected';
                    connectionStatus.className = 'status connected';
                    // No need to periodically request the board anymore
                };
                
                socket.onclose = () => {
                    connectionStatus.textContent = 'Disconnected. Attempting to reconnect...';
                    connectionStatus.className = 'status disconnected';
                    
                    // Try to reconnect after a delay
                    setTimeout(connect, 2000);
                };
                
                socket.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
                
                socket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        // Handle messages based on their type
                        if (data.type === 'fullBoard') {
                            // Full board update with the entire matrix
                            updateBoard(data.board);
                        } 
                        else if (data.type === 'stoneUpdate') {
                            // Single stone update
                            updateStone(data.row, data.col, data.stone);
                        }
                        else {
                            console.warn('Received unknown message type:', data);
                        }
                    } catch (e) {
                        console.error('Error parsing received data:', e);
                    }
                };
            }
            
            // Update a single stone on the board
            function updateStone(row, col, value) {
                const cell = board.querySelector(`td[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.textContent = value;
                    cell.style.backgroundColor = value == 0 ? '#ffffff' : 
                                              value == 1 ? '#000000' : 
                                              value == 2 ? '#ffffff' : '#e0e0e0';
                    cell.style.color = value == 1 ? '#ffffff' : '#000000';
                }
            }
            
            // Initialize the board and connect to WebSocket
            initBoard();
            connect();
        });
    </script>
</body>
</html>
